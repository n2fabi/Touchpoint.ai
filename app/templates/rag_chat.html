<!-- app/templates/rag_chat.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>RAG Chat | Touchpoint.ai</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <header class="header"><div class="logo"><img src="{{ url_for('static', filename='img/logo.png') }}" height="40"></div></header>
  <nav class="sidebar"><a href="{{ url_for('index.index') }}">Home</a><a href="{{ url_for('products.index') }}">Products</a></nav>

  <main class="main">
    <h2>Agentic RAG Chat</h2>

    <form method="post">
      <input type="text" name="query" value="{{ query }}" placeholder="Ask about a product..." style="width:70%">
      <button class="ask-btn" type="submit">Ask</button>
    </form>

    <section style="margin-top:20px;">
      {% if answer %}
        <div class="email-preview">
          <div class="email-body">{{ answer | replace('\n','<br>') | safe }}</div>
        </div>

        {% if sources %}
          <h4>Sources used</h4>
          <ul>
            {% for s in sources %}
              <li><strong>{{ s.product_id }}</strong> — {{ s.source }} — score: {{ "%.3f"|format(s.score) }}<br>
                  "{{ s.snippet }}"{% if not loop.last %}...{% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      {% else %}
        <p>Ask a question to fetch product info using the RAG agent.</p>
      {% endif %}
    </section>
  </main>
</body>
</html>
